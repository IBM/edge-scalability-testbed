---
- hosts: localhost
  gather_facts: no
  vars:
    region: 'us-east-2'
  tasks:
    - include_vars: "global_accelerator_vars.yaml"

    - name: Debug Disable Global Accelerator
      ansible.builtin.debug:
        msg: "{{ endpoint_group_arn  }}"

    - name: Delete Accelerator Endpoint Group
      shell: aws --region us-west-2 globalaccelerator delete-endpoint-group  --endpoint-group-arn {{ endpoint_group_arn  }}


    - name: Delete Accelerator Listener
      shell: aws --region us-west-2 globalaccelerator  delete-listener --listener-arn {{ listener_arn }}


    - name: Disable Global Accelerator
      shell: aws --region us-west-2 globalaccelerator update-accelerator --accelerator-arn {{  accelerator_arn }}  --no-enabled
      register: glt_endpoint_output

    - name: Debug Disable Global Accelerator
      ansible.builtin.debug:
        msg: "{{ glt_endpoint_output.stdout }}"

    - name: Sleep for 30 seconds and continue with play
      wait_for:
        timeout: 60
      delegate_to: localhost

    - name: Delete Global Accelerator
      shell: aws --region us-west-2 globalaccelerator delete-accelerator --accelerator-arn {{  accelerator_arn }} 

    - name: Remove file deletion_helper_vars.yaml
      ansible.builtin.file:
        path: "global_accelerator_vars.yaml"
        state: absent